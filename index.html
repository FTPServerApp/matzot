<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניהול עסק הדפסות תלת מימד</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.rtl.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #9b59b6;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 20px;
            background-color: #f9f9f9;
            color: var(--dark-color);
        }
        
        .container {
            max-width: 1200px;
        }
        
        .header-section {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            text-align: center;
        }
        
        .header-section h1 {
            margin: 0;
            font-weight: 700;
            font-size: 2.2rem;
        }
        
        .card {
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: none;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .card-header {
            background: linear-gradient(to right, rgba(52, 152, 219, 0.1), rgba(155, 89, 182, 0.1));
            font-weight: bold;
            border-bottom: 2px solid var(--primary-color);
            padding: 15px;
        }
        
        .nav-tabs {
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 20px;
        }
        
        .nav-tabs .nav-link {
            color: var(--dark-color);
            border: none;
            padding: 10px 20px;
            margin-right: 5px;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
        }
        
        .nav-tabs .nav-link:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .nav-tabs .nav-link.active {
            color: white;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border: none;
        }
        
        .tab-content {
            padding: 20px 0;
        }
        
        .status-pending {
            background-color: #fff3cd;
        }
        
        .status-printing {
            background-color: #d1ecf1;
        }
        
        .status-completed {
            background-color: #d4edda;
        }
        
        .status-delivered {
            background-color: #c3e6cb;
        }
        
        .status-cancelled {
            background-color: #f8d7da;
        }
        
        .printer-active {
            color: var(--secondary-color);
            font-weight: bold;
        }
        
        .printer-maintenance {
            color: var(--warning-color);
            font-weight: bold;
        }
        
        .printer-inactive {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        .low-stock {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        .english-text {
            direction: ltr;
            display: inline-block;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border: none;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, var(--accent-color), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn-success {
            background: linear-gradient(to right, var(--secondary-color), #27ae60);
            border: none;
        }
        
        .btn-success:hover {
            background: linear-gradient(to right, #27ae60, var(--secondary-color));
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn-warning {
            background: linear-gradient(to right, var(--warning-color), #e67e22);
            border: none;
        }
        
        .btn-warning:hover {
            background: linear-gradient(to right, #e67e22, var(--warning-color));
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn-danger {
            background: linear-gradient(to right, var(--danger-color), #c0392b);
            border: none;
        }
        
        .btn-danger:hover {
            background: linear-gradient(to right, #c0392b, var(--danger-color));
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .table {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }
        
        .table th {
            background-color: var(--light-color);
            color: var(--dark-color);
            font-weight: 600;
        }
        
        .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(236, 240, 241, 0.5);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 10px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }
        
        .dashboard-card {
            position: relative;
            min-height: 150px;
        }
        
        .dashboard-card .card-body {
            padding: 20px;
        }
        
        .dashboard-card .card-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2.5rem;
            opacity: 0.2;
            color: var(--primary-color);
        }
        
        .dashboard-card h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .dashboard-card p {
            font-size: 1rem;
            color: #7f8c8d;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
            font-weight: 600;
            font-size: 0.8rem;
            text-align: center;
        }
        
        .badge-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .badge-printing {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .badge-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .badge-delivered {
            background-color: #c3e6cb;
            color: #1e7e34;
        }
        
        .badge-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* Modal styling */
        .modal-content {
            border-radius: 10px;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            color: white;
            border-radius: 10px 10px 0 0;
            border-bottom: none;
        }
        
        .modal-footer {
            border-top: none;
        }
        
        /* Tooltip styling */
        .tooltip-inner {
            background-color: var(--dark-color);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            font-size: 0.9rem;
        }
        
        /* Animation for spinners */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        /* Custom checkbox styling */
        .custom-control {
            padding-right: 1.5rem;
        }
        
        .custom-control-label::before {
            border-radius: 3px;
            border: 2px solid var(--primary-color);
        }
        
        .custom-control-input:checked ~ .custom-control-label::before {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        /* Custom popover styling */
        .popover {
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            border: none;
        }
        
        .popover-header {
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            color: white;
            border-radius: 8px 8px 0 0;
        }
        
        /* SKU pattern box styling */
        .sku-pattern-box {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        .sku-preview {
            font-family: monospace;
            font-weight: bold;
            font-size: 1.2em;
            background-color: #eee;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px dashed #aaa;
            display: inline-block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1><i class="fas fa-cube me-2"></i> מערכת ניהול עסק הדפסות תלת מימד</h1>
        </div>
        
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                    <i class="fas fa-tachometer-alt me-1"></i> לוח בקרה
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="printers-tab" data-bs-toggle="tab" data-bs-target="#printers" type="button" role="tab">
                    <i class="fas fa-print me-1"></i> מדפסות
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="inventory-tab" data-bs-toggle="tab" data-bs-target="#inventory" type="button" role="tab">
                    <i class="fas fa-boxes me-1"></i> מלאי
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders" type="button" role="tab">
                    <i class="fas fa-shopping-cart me-1"></i> הזמנות
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="sku-generator-tab" data-bs-toggle="tab" data-bs-target="#sku-generator" type="button" role="tab">
                    <i class="fas fa-barcode me-1"></i> מחולל מק"ט
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">
                    <i class="fas fa-cog me-1"></i> הגדרות
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card dashboard-card">
                            <div class="card-body">
                                <div class="card-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <h2 id="pending-count">0</h2>
                                <p>הזמנות בהמתנה</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card dashboard-card">
                            <div class="card-body">
                                <div class="card-icon">
                                    <i class="fas fa-spinner"></i>
                                </div>
                                <h2 id="printing-count">0</h2>
                                <p>הזמנות בהדפסה</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card dashboard-card">
                            <div class="card-body">
                                <div class="card-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <h2 id="completed-count">0</h2>
                                <p>הזמנות שהושלמו</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card dashboard-card">
                            <div class="card-body">
                                <div class="card-icon">
                                    <i class="fas fa-truck"></i>
                                </div>
                                <h2 id="delivered-count">0</h2>
                                <p>הזמנות שנמסרו</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-print me-1"></i> מצב מדפסות
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 text-center">
                                        <div class="p-3">
                                            <i class="fas fa-check-circle fa-2x printer-active mb-2"></i>
                                            <h4 id="active-printers">0</h4>
                                            <p>מדפסות פעילות</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        <div class="p-3">
                                            <i class="fas fa-wrench fa-2x printer-maintenance mb-2"></i>
                                            <h4 id="maintenance-printers">0</h4>
                                            <p>מדפסות בתחזוקה</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        <div class="p-3">
                                            <i class="fas fa-times-circle fa-2x printer-inactive mb-2"></i>
                                            <h4 id="inactive-printers">0</h4>
                                            <p>מדפסות לא פעילות</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-exclamation-triangle me-1"></i> מלאי נמוך
                            </div>
                            <div class="card-body">
                                <ul id="low-stock-items" class="list-group">
                                    <!-- Low stock items will be populated here -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-shopping-cart me-1"></i> הזמנות אחרונות
                            </div>
                            <div class="card-body">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th><i class="fas fa-hashtag me-1"></i> מספר הזמנה</th>
                                            <th><i class="fas fa-user me-1"></i> לקוח</th>
                                            <th><i class="fas fa-calendar-alt me-1"></i> תאריך</th>
                                            <th><i class="fas fa-info-circle me-1"></i> סטטוס</th>
                                            <th><i class="fas fa-boxes me-1"></i> פריטים</th>
                                            <th><i class="fas fa-shekel-sign me-1"></i> סכום</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-orders">
                                        <!-- Recent orders will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Printers Tab -->
            <div class="tab-pane fade" id="printers" role="tabpanel">
                <div class="d-flex justify-content-between mb-3">
                    <h3><i class="fas fa-print me-2"></i> ניהול מדפסות</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPrinterModal">
                        <i class="fas fa-plus me-1"></i> הוסף מדפסת חדשה
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-hashtag me-1"></i> מזהה</th>
                                    <th><i class="fas fa-print me-1"></i> שם מדפסת</th>
                                    <th><i class="fas fa-tag me-1"></i> דגם</th>
                                    <th><i class="fas fa-info-circle me-1"></i> סטטוס</th>
                                    <th><i class="fas fa-calendar-alt me-1"></i> שימוש אחרון</th>
                                    <th><i class="fas fa-tools me-1"></i> פעולות</th>
                                </tr>
                            </thead>
                            <tbody id="printers-list">
                                <!-- Printers will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Inventory Tab -->
            <div class="tab-pane fade" id="inventory" role="tabpanel">
                <div class="d-flex justify-content-between mb-3">
                    <h3><i class="fas fa-boxes me-2"></i> ניהול מלאי</h3>
                    <div>
                        <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addInventoryModal">
                            <i class="fas fa-plus me-1"></i> הוסף פריט חדש
                        </button>
                        <button class="btn btn-success me-2" id="exportInventory">
                            <i class="fas fa-file-export me-1"></i> ייצא מלאי
                        </button>
                        <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#importInventoryModal">
                            <i class="fas fa-file-import me-1"></i> ייבא מלאי
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-hashtag me-1"></i> מזהה</th>
                                    <th><i class="fas fa-barcode me-1"></i> מק"ט</th>
                                    <th><i class="fas fa-box me-1"></i> שם פריט (אנגלית)</th>
                                    <th><i class="fas fa-folder me-1"></i> קטגוריה</th>
                                    <th><i class="fas fa-cubes me-1"></i> כמות במלאי</th>
                                    <th><i class="fas fa-shekel-sign me-1"></i> מחיר</th>
                                    <th><i class="fas fa-exclamation-circle me-1"></i> מינימום במלאי</th>
                                    <th><i class="fas fa-tools me-1"></i> פעולות</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-list">
                                <!-- Inventory items will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Orders Tab -->
            <div class="tab-pane fade" id="orders" role="tabpanel">
                <div class="d-flex justify-content-between mb-3">
                    <h3><i class="fas fa-shopping-cart me-2"></i> ניהול הזמנות</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addOrderModal">
                        <i class="fas fa-plus me-1"></i> הוסף הזמנה חדשה
                    </button>
                </div>
                
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-filter me-1"></i> סינון לפי סטטוס:</span>
                            <select class="form-select" id="orderStatusFilter">
                                <option value="all">הכל</option>
                                <option value="pending">בהמתנה</option>
                                <option value="printing">בהדפסה</option>
                                <option value="completed">הושלם</option>
                                <option value="delivered">נמסר</option>
                                <option value="cancelled">בוטל</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-hashtag me-1"></i> מספר הזמנה</th>
                                    <th><i class="fas fa-user me-1"></i> לקוח</th>
                                    <th><i class="fas fa-calendar-alt me-1"></i> תאריך</th>
                                    <th><i class="fas fa-info-circle me-1"></i> סטטוס</th>
                                    <th><i class="fas fa-shekel-sign me-1"></i> סכום</th>
                                    <th><i class="fas fa-boxes me-1"></i> פריטים</th>
                                    <th><i class="fas fa-tools me-1"></i> פעולות</th>
                                </tr>
                            </thead>
                            <tbody id="orders-list">
                                <!-- Orders will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- SKU Generator Tab -->
            <div class="tab-pane fade" id="sku-generator" role="tabpanel">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-barcode me-1"></i> מחולל מספרי מק"ט (SKU)
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-1"></i> מחולל המק"ט מאפשר לך ליצור מספרי מק"ט עקביים לפריטים במלאי שלך.
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">הגדרת מבנה המק"ט</div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label for="skuPrefix" class="form-label">קידומת (לדוגמה: 3DP-)</label>
                                                    <input type="text" class="form-control english-text" id="skuPrefix" placeholder="קידומת המק״ט">
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">כלול במק"ט:</label>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" value="category" id="includeCategoryCode" checked>
                                                        <label class="form-check-label" for="includeCategoryCode">
                                                            קוד קטגוריה (2 תווים)
                                                        </label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" value="itemName" id="includeNameCode" checked>
                                                        <label class="form-check-label" for="includeNameCode">
                                                            קוד שם פריט (3 תווים)
                                                        </label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" value="sequential" id="includeSequential" checked>
                                                        <label class="form-check-label" for="includeSequential">
                                                            מספר סידורי (4 ספרות)
                                                        </label>
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="separator" class="form-label">תו מפריד (לדוגמה: -)</label>
                                                    <input type="text" class="form-control english-text" id="skuSeparator" placeholder="תו מפריד" value="-" maxlength="1">
                                                </div>
                                                
                                                <div class="sku-pattern-box text-center mt-4">
                                                    <div class="mb-2">מבנה המק"ט:</div>
                                                    <div id="skuPattern" class="fs-5 mb-3">PREFIX-CC-NNN-0001</div>
                                                    <div>דוגמה למק"ט:</div>
                                                    <div class="sku-preview" id="skuPreview">3DP-FL-PLA-0001</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">יצירת מק"ט חדש</div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label for="skuCategorySelect" class="form-label">קטגוריה</label>
                                                    <select class="form-select" id="skuCategorySelect">
                                                        <option value="">בחר קטגוריה</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="skuItemName" class="form-label">שם פריט (באנגלית)</label>
                                                    <input type="text" class="form-control english-text" id="skuItemName" placeholder="שם הפריט באנגלית">
                                                </div>
                                                
                                                <div class="alert alert-success mt-4" id="generatedSkuContainer">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <strong>מק"ט שנוצר:</strong>
                                                            <div id="generatedSku" class="fs-4 mt-2">3DP-FL-PLA-0001</div>
                                                        </div>
                                                        <button class="btn btn-primary" id="copySkuBtn" title="העתק מק״ט">
                                                            <i class="fas fa-copy"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <button class="btn btn-primary w-100 mt-3" id="generateSkuBtn">
                                                    <i class="fas fa-barcode me-1"></i> צור מק"ט חדש
                                                </button>
                                                
                                                <button class="btn btn-success w-100 mt-3" id="addItemWithSkuBtn">
                                                    <i class="fas fa-plus me-1"></i> הוסף פריט עם מק"ט זה
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="card mt-3">
                                            <div class="card-header">קודי קטגוריות</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <ul class="list-group" id="categoryCodesList1">
                                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                <span>פילמנטים</span>
                                                                <span class="badge bg-primary">FL</span>
                                                            </li>
                                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                <span>חלקי חילוף</span>
                                                                <span class="badge bg-primary">SP</span>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <ul class="list-group" id="categoryCodesList2">
                                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                <span>אביזרים</span>
                                                                <span class="badge bg-primary">AC</span>
                                                            </li>
                                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                <span>כלים</span>
                                                                <span class="badge bg-primary">TL</span>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="text-center mt-3">
                                                    <button class="btn btn-sm btn-outline-primary" id="editCategoryCodesBtn">
                                                        <i class="fas fa-edit me-1"></i> ערוך קודי קטגוריות
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-save me-1"></i> גיבוי ושחזור
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <button class="btn btn-primary" id="exportAllData">
                                        <i class="fas fa-file-export me-1"></i> ייצא את כל הנתונים
                                    </button>
                                    <p class="small text-muted mt-2">ייצוא של כל הנתונים (מדפסות, מלאי והזמנות) לקובץ JSON אחד</p>
                                </div>
                                <div class="mb-3">
                                    <label for="importDataFile" class="form-label">ייבא נתונים מקובץ</label>
                                    <input class="form-control" type="file" id="importDataFile" accept=".json">
                                    <button class="btn btn-warning mt-2" id="importAllData">
                                        <i class="fas fa-file-import me-1"></i> ייבא נתונים
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-sync me-1"></i> הגדרות סנכרון
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="syncFrequency" class="form-label">תדירות סנכרון עם אפליקציית אנדרואיד</label>
                                    <select class="form-select" id="syncFrequency">
                                        <option value="manual">ידני בלבד</option>
                                        <option value="hourly">כל שעה</option>
                                        <option value="daily">יומי</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <button class="btn btn-primary" id="syncNow">
                                        <i class="fas fa-sync me-1"></i> סנכרן עכשיו
                                    </button>
                                    <span class="ms-2" id="lastSyncTime">עדיין לא סונכרן</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-palette me-1"></i> התאמת מראה
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="primaryColorPicker" class="form-label">צבע ראשי</label>
                                            <input type="color" class="form-control" id="primaryColorPicker" value="#3498db">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="secondaryColorPicker" class="form-label">צבע משני</label>
                                            <input type="color" class="form-control" id="secondaryColorPicker" value="#2ecc71">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="accentColorPicker" class="form-label">צבע הדגשה</label>
                                            <input type="color" class="form-control" id="accentColorPicker" value="#9b59b6">
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-primary" id="applyThemeBtn">
                                    <i class="fas fa-check me-1"></i> החל שינויים
                                </button>
                                <button class="btn btn-outline-secondary ms-2" id="resetThemeBtn">
                                    <i class="fas fa-undo me-1"></i> אפס לברירת מחדל
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <!-- Add Printer Modal -->
    <div class="modal fade" id="addPrinterModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-print me-1"></i> הוסף מדפסת חדשה</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addPrinterForm">
                        <div class="mb-3">
                            <label for="printerName" class="form-label">שם מדפסת</label>
                            <input type="text" class="form-control" id="printerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="printerModel" class="form-label">דגם</label>
                            <input type="text" class="form-control" id="printerModel" required>
                        </div>
                        <div class="mb-3">
                            <label for="printerStatus" class="form-label">סטטוס</label>
                            <select class="form-select" id="printerStatus">
                                <option value="active">פעיל</option>
                                <option value="maintenance">בתחזוקה</option>
                                <option value="inactive">לא פעיל</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                    <button type="button" class="btn btn-primary" id="savePrinterBtn">שמור</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Inventory Modal -->
    <div class="modal fade" id="addInventoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-box me-1"></i> הוסף פריט מלאי חדש</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addInventoryForm">
                        <div class="mb-3">
                            <label for="itemSku" class="form-label">מק"ט</label>
                            <div class="input-group">
                                <input type="text" class="form-control english-text" id="itemSku">
                                <button class="btn btn-outline-secondary" type="button" id="generateSkuFromModal">
                                    <i class="fas fa-barcode"></i> צור מק"ט
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="itemName" class="form-label">שם פריט (אנגלית)</label>
                            <input type="text" class="form-control english-text" id="itemName" required>
                        </div>
                        <div class="mb-3">
                            <label for="itemCategory" class="form-label">קטגוריה</label>
                            <input type="text" class="form-control" id="itemCategory" required>
                        </div>
                        <div class="mb-3">
                            <label for="itemQuantity" class="form-label">כמות במלאי</label>
                            <input type="number" class="form-control" id="itemQuantity" required min="0">
                        </div>
                        <div class="mb-3">
                            <label for="itemPrice" class="form-label">מחיר</label>
                            <div class="input-group">
                                <span class="input-group-text">₪</span>
                                <input type="number" class="form-control" id="itemPrice" required min="0" step="0.01">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="itemMinQuantity" class="form-label">כמות מינימלית (התראה)</label>
                            <input type="number" class="form-control" id="itemMinQuantity" required min="0">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                    <button type="button" class="btn btn-primary" id="saveInventoryBtn">שמור</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Order Modal -->
    <div class="modal fade" id="addOrderModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-shopping-cart me-1"></i> הוסף הזמנה חדשה</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addOrderForm">
                        <div class="mb-3">
                            <label for="customerName" class="form-label">שם לקוח</label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="orderDate" class="form-label">תאריך</label>
                            <input type="date" class="form-control" id="orderDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="orderStatus" class="form-label">סטטוס</label>
                            <select class="form-select" id="orderStatus">
                                <option value="pending">בהמתנה</option>
                                <option value="printing">בהדפסה</option>
                                <option value="completed">הושלם</option>
                                <option value="delivered">נמסר</option>
                                <option value="cancelled">בוטל</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">פריטים</label>
                            <div id="orderItems">
                                <div class="order-item row mb-2 align-items-center">
                                    <div class="col-5">
                                        <select class="form-select item-select"></select>
                                    </div>
                                    <div class="col-2">
                                        <input type="number" class="form-control item-quantity" placeholder="כמות" min="1" required>
                                    </div>
                                    <div class="col-3">
                                        <div class="input-group">
                                            <span class="input-group-text">₪</span>
                                            <input type="number" class="form-control item-price" placeholder="מחיר" readonly>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <button type="button" class="btn btn-danger remove-item">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-info mt-2" id="addOrderItemBtn">
                                <i class="fas fa-plus me-1"></i> הוסף פריט
                            </button>
                        </div>
                        <div class="mb-3">
                            <label for="orderTotal" class="form-label">סה"כ</label>
                            <div class="input-group">
                                <span class="input-group-text">₪</span>
                                <input type="number" class="form-control" id="orderTotal" readonly>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                    <button type="button" class="btn btn-primary" id="saveOrderBtn">שמור</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Import Inventory Modal -->
    <div class="modal fade" id="importInventoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-file-import me-1"></i> ייבא מלאי מקובץ JSON</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="importInventoryForm">
                        <div class="mb-3">
                            <label for="inventoryFile" class="form-label">בחר קובץ JSON</label>
                            <input class="form-control" type="file" id="inventoryFile" accept=".json">
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="importOption" id="mergeOption" value="merge" checked>
                                <label class="form-check-label" for="mergeOption">
                                    מזג עם מלאי קיים
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="importOption" id="replaceOption" value="replace">
                                <label class="form-check-label" for="replaceOption">
                                    החלף מלאי קיים
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                    <button type="button" class="btn btn-primary" id="importInventoryBtn">ייבא</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Category Codes Modal -->
    <div class="modal fade" id="editCategoryCodesModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-tags me-1"></i> ערוך קודי קטגוריות</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-1"></i> הגדר קודי קטגוריה בני 2 תווים לשימוש במק"ט.
                    </div>
                    <div id="categoryCodesContainer">
                        <div class="category-code-item row mb-2 align-items-center">
                            <div class="col-6">
                                <input type="text" class="form-control category-name" placeholder="שם קטגוריה">
                            </div>
                            <div class="col-4">
                                <input type="text" class="form-control english-text category-code" placeholder="קוד" maxlength="2">
                            </div>
                            <div class="col-2">
                                <button type="button" class="btn btn-danger remove-category-code">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-info mt-2" id="addCategoryCodeBtn">
                        <i class="fas fa-plus me-1"></i> הוסף קטגוריה
                    </button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                    <button type="button" class="btn btn-primary" id="saveCategoryCodesBtn">שמור</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data structure
        let data = {
            printers: [],
            inventory: [],
            orders: [],
            categoryCodes: [
                { name: "פילמנטים", code: "FL" },
                { name: "חלקי חילוף", code: "SP" },
                { name: "אביזרים", code: "AC" },
                { name: "כלים", code: "TL" }
            ],
            skuCounters: {},
            settings: {
                syncFrequency: 'manual',
                lastSync: null,
                theme: {
                    primaryColor: '#3498db',
                    secondaryColor: '#2ecc71',
                    accentColor: '#9b59b6'
                }
            }
        };

        // Initialize the application
        $(document).ready(function() {
            // Load data from localStorage if exists
            loadData();
            
            // Update UI
            updateUI();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize tooltips
            initializeTooltips();
            
            // Initialize SKU Generator
            initializeSkuGenerator();
            
            // Initialize date inputs with today's date
            const today = new Date().toISOString().split('T')[0];
            $('#orderDate').val(today);
            
            // Populate the first item dropdown
            populateItemDropdown($('.item-select').first());
        });

        // Initialize tooltips
        function initializeTooltips() {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        }

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('3dPrinterBusinessData');
            if (savedData) {
                try {
                    data = JSON.parse(savedData);
                    
                    // Ensure all required properties exist
                    if (!data.categoryCodes) {
                        data.categoryCodes = [
                            { name: "פילמנטים", code: "FL" },
                            { name: "חלקי חילוף", code: "SP" },
                            { name: "אביזרים", code: "AC" },
                            { name: "כלים", code: "TL" }
                        ];
                    }
                    
                    if (!data.skuCounters) {
                        data.skuCounters = {};
                    }
                    
                    if (!data.settings.theme) {
                        data.settings.theme = {
                            primaryColor: '#3498db',
                            secondaryColor: '#2ecc71',
                            accentColor: '#9b59b6'
                        };
                    }
                    
                } catch (e) {
                    console.error('Error parsing data:', e);
                    // Initialize with some sample data if there's an error
                    initializeSampleData();
                }
            } else {
                // Initialize with some sample data if no data exists
                initializeSampleData();
            }
        }

        // Initialize with sample data
        function initializeSampleData() {
            data.printers = [
                { id: 1, name: 'מדפסת 1', model: 'Prusa i3 MK3S+', status: 'active', lastUsed: '2023-05-15' },
                { id: 2, name: 'מדפסת 2', model: 'Creality Ender 3', status: 'maintenance', lastUsed: '2023-05-10' }
            ];
            
            data.inventory = [
                { id: 1, sku: '3DP-FL-PLA-0001', name: 'PLA Filament Black', category: 'פילמנטים', quantity: 5, price: 89.99, minQuantity: 2 },
                { id: 2, sku: '3DP-FL-ABS-0001', name: 'ABS Filament White', category: 'פילמנטים', quantity: 3, price: 99.99, minQuantity: 2 },
                { id: 3, sku: '3DP-SP-BED-0001', name: 'Print Bed Sheet', category: 'חלקי חילוף', quantity: 10, price: 149.99, minQuantity: 3 }
            ];
            
            data.orders = [
                { 
                    id: 1, 
                    customer: 'ישראל ישראלי', 
                    date: '2023-05-14', 
                    status: 'completed', 
                    total: 179.98,
                    items: [
                        { itemId: 1, quantity: 2, price: 89.99 }
                    ] 
                },
                { 
                    id: 2, 
                    customer: 'שרה כהן', 
                    date: '2023-05-16', 
                    status: 'pending', 
                    total: 249.98,
                    items: [
                        { itemId: 2, quantity: 1, price: 99.99 },
                        { itemId: 3, quantity: 1, price: 149.99 }
                    ] 
                }
            ];
            
            data.categoryCodes = [
                { name: "פילמנטים", code: "FL" },
                { name: "חלקי חילוף", code: "SP" },
                { name: "אביזרים", code: "AC" },
                { name: "כלים", code: "TL" }
            ];
            
            data.skuCounters = {
                "FL-PLA": 1,
                "FL-ABS": 1,
                "SP-BED": 1
            };
            
            data.settings = {
                syncFrequency: 'manual',
                lastSync: null,
                theme: {
                    primaryColor: '#3498db',
                    secondaryColor: '#2ecc71',
                    accentColor: '#9b59b6'
                }
            };
            
            saveData();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('3dPrinterBusinessData', JSON.stringify(data));
        }

        // Update the UI with current data
        function updateUI() {
            updateDashboard();
            updatePrintersList();
            updateInventoryList();
            updateOrdersList();
            updateSettingsUI();
            updateCategoryCodesList();
            updateTheme();
        }

        // Update the Dashboard UI
        function updateDashboard() {
            // Update order counts
            const pendingCount = data.orders.filter(order => order.status === 'pending').length;
            const printingCount = data.orders.filter(order => order.status === 'printing').length;
            const completedCount = data.orders.filter(order => order.status === 'completed').length;
            const deliveredCount = data.orders.filter(order => order.status === 'delivered').length;
            
            $('#pending-count').text(pendingCount);
            $('#printing-count').text(printingCount);
            $('#completed-count').text(completedCount);
            $('#delivered-count').text(deliveredCount);
            
            // Update printer status counts
            const activePrinters = data.printers.filter(printer => printer.status === 'active').length;
            const maintenancePrinters = data.printers.filter(printer => printer.status === 'maintenance').length;
            const inactivePrinters = data.printers.filter(printer => printer.status === 'inactive').length;
            
            $('#active-printers').text(activePrinters);
            $('#maintenance-printers').text(maintenancePrinters);
            $('#inactive-printers').text(inactivePrinters);
            
            // Update low stock items
            const lowStockItems = data.inventory.filter(item => item.quantity <= item.minQuantity);
            const $lowStockList = $('#low-stock-items');
            $lowStockList.empty();
            
            if (lowStockItems.length > 0) {
                lowStockItems.forEach(item => {
                    $lowStockList.append(`
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="english-text">${item.name}</span>
                            <span class="badge bg-danger rounded-pill">${item.quantity}/${item.minQuantity}</span>
                        </li>
                    `);
                });
            } else {
                $lowStockList.append('<li class="list-group-item">אין פריטים במלאי נמוך</li>');
            }
            
            // Update recent orders
            const recentOrders = [...data.orders].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            const $recentOrdersList = $('#recent-orders');
            $recentOrdersList.empty();
            
            if (recentOrders.length > 0) {
                recentOrders.forEach(order => {
                    let statusClass = '';
                    let statusText = '';
                    let statusBadgeClass = '';
                    
                    switch(order.status) {
                        case 'pending': 
                            statusClass = 'status-pending'; 
                            statusText = 'בהמתנה';
                            statusBadgeClass = 'badge-pending';
                            break;
                        case 'printing': 
                            statusClass = 'status-printing'; 
                            statusText = 'בהדפסה';
                            statusBadgeClass = 'badge-printing';
                            break;
                        case 'completed': 
                            statusClass = 'status-completed'; 
                            statusText = 'הושלם';
                            statusBadgeClass = 'badge-completed';
                            break;
                        case 'delivered': 
                            statusClass = 'status-delivered'; 
                            statusText = 'נמסר';
                            statusBadgeClass = 'badge-delivered';
                            break;
                        case 'cancelled': 
                            statusClass = 'status-cancelled'; 
                            statusText = 'בוטל';
                            statusBadgeClass = 'badge-cancelled';
                            break;
                    }
                    
                    $recentOrdersList.append(`
                        <tr>
                            <td>${order.id}</td>
                            <td>${order.customer}</td>
                            <td>${formatDate(order.date)}</td>
                            <td><span class="status-badge ${statusBadgeClass}">${statusText}</span></td>
                            <td>${order.items.length}</td>
                            <td>₪${order.total.toFixed(2)}</td>
                        </tr>
                    `);
                });
            } else {
                $recentOrdersList.append('<tr><td colspan="6" class="text-center">אין הזמנות אחרונות</td></tr>');
            }
        }

        // Update the Printers list
        function updatePrintersList() {
            const $printersList = $('#printers-list');
            $printersList.empty();
            
            if (data.printers.length > 0) {
                data.printers.forEach(printer => {
                    let statusClass = '';
                    let statusText = '';
                    let statusIcon = '';
                    
                    switch(printer.status) {
                        case 'active': 
                            statusClass = 'printer-active'; 
                            statusText = 'פעיל';
                            statusIcon = 'check-circle';
                            break;
                        case 'maintenance': 
                            statusClass = 'printer-maintenance'; 
                            statusText = 'בתחזוקה';
                            statusIcon = 'wrench';
                            break;
                        case 'inactive': 
                            statusClass = 'printer-inactive'; 
                            statusText = 'לא פעיל';
                            statusIcon = 'times-circle';
                            break;
                    }
                    
                    $printersList.append(`
                        <tr>
                            <td>${printer.id}</td>
                            <td>${printer.name}</td>
                            <td>${printer.model}</td>
                            <td class="${statusClass}"><i class="fas fa-${statusIcon} me-1"></i> ${statusText}</td>
                            <td>${formatDate(printer.lastUsed)}</td>
                            <td>
                                <button class="btn btn-sm btn-primary edit-printer" data-id="${printer.id}" title="ערוך מדפסת">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-printer" data-id="${printer.id}" title="מחק מדפסת">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            } else {
                $printersList.append('<tr><td colspan="6" class="text-center">אין מדפסות</td></tr>');
            }
        }

        // Update the Inventory list
        function updateInventoryList() {
            const $inventoryList = $('#inventory-list');
            $inventoryList.empty();
            
            if (data.inventory.length > 0) {
                data.inventory.forEach(item => {
                    const lowStockClass = item.quantity <= item.minQuantity ? 'low-stock' : '';
                    const sku = item.sku || '-';
                    
                    $inventoryList.append(`
                        <tr>
                            <td>${item.id}</td>
                            <td><span class="english-text">${sku}</span></td>
                            <td><span class="english-text">${item.name}</span></td>
                            <td>${item.category}</td>
                            <td class="${lowStockClass}">${item.quantity}</td>
                            <td>₪${item.price.toFixed(2)}</td>
                            <td>${item.minQuantity}</td>
                            <td>
                                <button class="btn btn-sm btn-primary edit-inventory" data-id="${item.id}" title="ערוך פריט">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-inventory" data-id="${item.id}" title="מחק פריט">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            } else {
                $inventoryList.append('<tr><td colspan="8" class="text-center">אין פריטים במלאי</td></tr>');
            }
        }

        // Update the Orders list
        function updateOrdersList() {
            const $ordersList = $('#orders-list');
            $ordersList.empty();
            
            const statusFilter = $('#orderStatusFilter').val();
            let filteredOrders = [...data.orders];
            
            if (statusFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }
            
            if (filteredOrders.length > 0) {
                filteredOrders.forEach(order => {
                    let statusText = '';
                    let statusBadgeClass = '';
                    
                    switch(order.status) {
                        case 'pending': 
                            statusText = 'בהמתנה';
                            statusBadgeClass = 'badge-pending';
                            break;
                        case 'printing': 
                            statusText = 'בהדפסה';
                            statusBadgeClass = 'badge-printing';
                            break;
                        case 'completed': 
                            statusText = 'הושלם';
                            statusBadgeClass = 'badge-completed';
                            break;
                        case 'delivered': 
                            statusText = 'נמסר';
                            statusBadgeClass = 'badge-delivered';
                            break;
                        case 'cancelled': 
                            statusText = 'בוטל';
                            statusBadgeClass = 'badge-cancelled';
                            break;
                    }
                    
                    $ordersList.append(`
                        <tr>
                            <td>${order.id}</td>
                            <td>${order.customer}</td>
                            <td>${formatDate(order.date)}</td>
                            <td><span class="status-badge ${statusBadgeClass}">${statusText}</span></td>
                            <td>₪${order.total.toFixed(2)}</td>
                            <td>${order.items.length}</td>
                            <td>
                                <button class="btn btn-sm btn-info view-order" data-id="${order.id}" title="צפה בהזמנה">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-success update-status" data-id="${order.id}" title="עדכן סטטוס">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-order" data-id="${order.id}" title="מחק הזמנה">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            } else {
                $ordersList.append('<tr><td colspan="7" class="text-center">אין הזמנות</td></tr>');
            }
        }

        // Update settings UI
        function updateSettingsUI() {
            $('#syncFrequency').val(data.settings.syncFrequency);
            if (data.settings.lastSync) {
                $('#lastSyncTime').text(`סונכרן לאחרונה: ${formatDateTime(data.settings.lastSync)}`);
            } else {
                $('#lastSyncTime').text('עדיין לא סונכרן');
            }
            
            // Update color pickers
            $('#primaryColorPicker').val(data.settings.theme.primaryColor);
            $('#secondaryColorPicker').val(data.settings.theme.secondaryColor);
            $('#accentColorPicker').val(data.settings.theme.accentColor);
        }
        
        // Update category codes list
        function updateCategoryCodesList() {
            const $categoryCodesList1 = $('#categoryCodesList1');
            const $categoryCodesList2 = $('#categoryCodesList2');
            $categoryCodesList1.empty();
            $categoryCodesList2.empty();
            
            // Update SKU generator dropdown
            const $skuCategorySelect = $('#skuCategorySelect');
            $skuCategorySelect.empty();
            $skuCategorySelect.append('<option value="">בחר קטגוריה</option>');
            
            if (data.categoryCodes.length > 0) {
                const halfLength = Math.ceil(data.categoryCodes.length / 2);
                
                data.categoryCodes.forEach((category, index) => {
                    const listItem = `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>${category.name}</span>
                            <span class="badge bg-primary">${category.code}</span>
                        </li>
                    `;
                    
                    // Add to dropdown
                    $skuCategorySelect.append(`<option value="${category.code}">${category.name}</option>`);
                    
                    // Add to the appropriate list
                    if (index < halfLength) {
                        $categoryCodesList1.append(listItem);
                    } else {
                        $categoryCodesList2.append(listItem);
                    }
                });
            } else {
                $categoryCodesList1.append('<li class="list-group-item">אין קודי קטגוריות</li>');
            }
        }
        
        // Update theme colors
        function updateTheme() {
            const root = document.documentElement;
            root.style.setProperty('--primary-color', data.settings.theme.primaryColor);
            root.style.setProperty('--secondary-color', data.settings.theme.secondaryColor);
            root.style.setProperty('--accent-color', data.settings.theme.accentColor);
        }

        // Helper function to format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('he-IL');
        }

        // Helper function to format date and time
        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleString('he-IL');
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Printers tab
            $('#savePrinterBtn').on('click', savePrinter);
            $(document).on('click', '.edit-printer', editPrinter);
            $(document).on('click', '.delete-printer', deletePrinter);
            
            // Inventory tab
            $('#saveInventoryBtn').on('click', saveInventory);
            $(document).on('click', '.edit-inventory', editInventory);
            $(document).on('click', '.delete-inventory', deleteInventory);
            $('#exportInventory').on('click', exportInventory);
            $('#importInventoryBtn').on('click', importInventory);
            $('#generateSkuFromModal').on('click', openSkuGeneratorFromModal);
            
            // Orders tab
            $('#orderStatusFilter').on('change', updateOrdersList);
            $('#saveOrderBtn').on('click', saveOrder);
            $('#addOrderItemBtn').on('click', addOrderItemRow);
            $(document).on('click', '.remove-item', removeOrderItem);
            $(document).on('change', '.item-select, .item-quantity', updateOrderItemPrice);
            $(document).on('click', '.view-order', viewOrder);
            $(document).on('click', '.update-status', updateOrderStatus);
            $(document).on('click', '.delete-order', deleteOrder);
            
            // Settings tab
            $('#exportAllData').on('click', exportAllData);
            $('#importAllData').on('click', importAllData);
            $('#syncNow').on('click', syncNow);
            $('#syncFrequency').on('change', updateSyncFrequency);
            $('#applyThemeBtn').on('click', applyTheme);
            $('#resetThemeBtn').on('click', resetTheme);
            
            // SKU Generator tab
            $('#skuPrefix, #skuSeparator, #includeCategoryCode, #includeNameCode, #includeSequential').on('input change', updateSkuPattern);
            $('#generateSkuBtn').on('click', generateSku);
            $('#copySkuBtn').on('click', copySku);
            $('#addItemWithSkuBtn').on('click', addItemWithSku);
            $('#editCategoryCodesBtn').on('click', openEditCategoryCodesModal);
            $('#addCategoryCodeBtn').on('click', addCategoryCodeRow);
            $(document).on('click', '.remove-category-code', removeCategoryCodeRow);
            $('#saveCategoryCodesBtn').on('click', saveCategoryCodes);
            
            // Event listener for item name and category in SKU generator
            $('#skuItemName, #skuCategorySelect').on('input change', updateSkuPreview);
        }

        // Initialize SKU Generator
        function initializeSkuGenerator() {
            updateSkuPattern();
            updateSkuPreview();
            
            // Prepare the edit category codes modal
            $('#editCategoryCodesBtn').click(function() {
                prepareCategoryCodesModal();
            });
        }
        
        // Update SKU pattern display
        function updateSkuPattern() {
            let pattern = '';
            const prefix = $('#skuPrefix').val() || 'PREFIX';
            const separator = $('#skuSeparator').val() || '-';
            
            pattern += prefix;
            
            if ($('#includeCategoryCode').is(':checked')) {
                pattern += separator + 'CC';
            }
            
            if ($('#includeNameCode').is(':checked')) {
                pattern += separator + 'NNN';
            }
            
            if ($('#includeSequential').is(':checked')) {
                pattern += separator + '0001';
            }
            
            $('#skuPattern').text(pattern);
            
            updateSkuPreview();
        }
        
        // Update SKU preview
        function updateSkuPreview() {
            const prefix = $('#skuPrefix').val() || '3DP';
            const separator = $('#skuSeparator').val() || '-';
            const categoryCode = $('#skuCategorySelect').val() || 'FL';
            const itemName = $('#skuItemName').val() || 'PLA';
            
            let nameCode = '';
            if (itemName) {
                // Take first 3 letters or the entire string if shorter
                nameCode = itemName.substring(0, 3).toUpperCase();
            } else {
                nameCode = 'PLA';
            }
            
            let preview = prefix;
            
            if ($('#includeCategoryCode').is(':checked')) {
                preview += separator + categoryCode;
            }
            
            if ($('#includeNameCode').is(':checked')) {
                preview += separator + nameCode;
            }
            
            if ($('#includeSequential').is(':checked')) {
                preview += separator + '0001';
            }
            
            $('#skuPreview').text(preview);
            $('#generatedSku').text(preview);
        }
        
        // Generate a new SKU
        function generateSku() {
            const prefix = $('#skuPrefix').val() || '3DP';
            const separator = $('#skuSeparator').val() || '-';
            const categoryCode = $('#skuCategorySelect').val();
            const itemName = $('#skuItemName').val();
            
            if (!categoryCode) {
                alert('אנא בחר קטגוריה');
                return;
            }
            
            if (!itemName) {
                alert('אנא הזן שם פריט');
                return;
            }
            
            // Generate name code (first 3 letters)
            const nameCode = itemName.substring(0, 3).toUpperCase();
            
            // Create the key for counter
            const counterKey = categoryCode + '-' + nameCode;
            
            // Get or initialize the counter
            if (!data.skuCounters[counterKey]) {
                data.skuCounters[counterKey] = 0;
            }
            
            // Increment the counter
            data.skuCounters[counterKey]++;
            
            // Format the sequential number with leading zeros
            const sequentialNumber = data.skuCounters[counterKey].toString().padStart(4, '0');
            
            // Build the SKU
            let sku = prefix;
            
            if ($('#includeCategoryCode').is(':checked')) {
                sku += separator + categoryCode;
            }
            
            if ($('#includeNameCode').is(':checked')) {
                sku += separator + nameCode;
            }
            
            if ($('#includeSequential').is(':checked')) {
                sku += separator + sequentialNumber;
            }
            
            // Update UI
            $('#generatedSku').text(sku);
            
            // Save the updated counter
            saveData();
            
            return sku;
        }
        
        // Copy the generated SKU to clipboard
        function copySku() {
            const sku = $('#generatedSku').text();
            
            // Create a temporary input element
            const tempInput = document.createElement('input');
            tempInput.value = sku;
            document.body.appendChild(tempInput);
            
            // Select and copy the text
            tempInput.select();
            document.execCommand('copy');
            
            // Remove the temporary element
            document.body.removeChild(tempInput);
            
            // Show feedback
            const originalText = $('#copySkuBtn').html();
            $('#copySkuBtn').html('<i class="fas fa-check"></i>');
            
            setTimeout(function() {
                $('#copySkuBtn').html(originalText);
            }, 1500);
        }
        
        // Add a new item with the generated SKU
        function addItemWithSku() {
            const sku = $('#generatedSku').text();
            const itemName = $('#skuItemName').val();
            const categoryCode = $('#skuCategorySelect').val();
            
            if (!categoryCode || !itemName) {
                alert('אנא בחר קטגוריה והזן שם פריט');
                return;
            }
            
            // Find the full category name from the code
            const category = data.categoryCodes.find(c => c.code === categoryCode);
            
            if (!category) {
                alert('קטגוריה לא נמצאה');
                return;
            }
            
            // Reset the inventory form
            $('#addInventoryForm')[0].reset();
            
            // Populate the form with the generated data
            $('#itemSku').val(sku);
            $('#itemName').val(itemName);
            $('#itemCategory').val(category.name);
            
            // Focus on the quantity field
            $('#addInventoryModal').modal('show');
            setTimeout(function() {
                $('#itemQuantity').focus();
            }, 500);
        }
        
        // Open the SKU generator from the inventory modal
        function openSkuGeneratorFromModal() {
            const itemName = $('#itemName').val();
            const category = $('#itemCategory').val();
            
            // Switch to the SKU generator tab
            $('#sku-generator-tab').tab('show');
            
            // Pre-fill the fields if available
            if (itemName) {
                $('#skuItemName').val(itemName);
            }
            
            if (category) {
                // Find the category code
                const categoryData = data.categoryCodes.find(c => c.name === category);
                if (categoryData) {
                    $('#skuCategorySelect').val(categoryData.code);
                }
            }
            
            // Update the preview
            updateSkuPreview();
            
            // Hide the modal
            $('#addInventoryModal').modal('hide');
        }
        
        // Prepare the category codes modal with current data
        function prepareCategoryCodesModal() {
            const $container = $('#categoryCodesContainer');
            $container.empty();
            
            if (data.categoryCodes.length > 0) {
                data.categoryCodes.forEach(category => {
                    $container.append(`
                        <div class="category-code-item row mb-2 align-items-center">
                            <div class="col-6">
                                <input type="text" class="form-control category-name" placeholder="שם קטגוריה" value="${category.name}">
                            </div>
                            <div class="col-4">
                                <input type="text" class="form-control english-text category-code" placeholder="קוד" maxlength="2" value="${category.code}">
                            </div>
                            <div class="col-2">
                                <button type="button" class="btn btn-danger remove-category-code">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `);
                });
            } else {
                addCategoryCodeRow();
            }
            
            $('#editCategoryCodesModal').modal('show');
        }
        
        // Add a new category code row
        function addCategoryCodeRow() {
            $('#categoryCodesContainer').append(`
                <div class="category-code-item row mb-2 align-items-center">
                    <div class="col-6">
                        <input type="text" class="form-control category-name" placeholder="שם קטגוריה">
                    </div>
                    <div class="col-4">
                        <input type="text" class="form-control english-text category-code" placeholder="קוד" maxlength="2">
                    </div>
                    <div class="col-2">
                        <button type="button" class="btn btn-danger remove-category-code">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `);
        }
        
        // Remove a category code row
        function removeCategoryCodeRow() {
            $(this).closest('.category-code-item').remove();
        }
        
        // Save category codes
        function saveCategoryCodes() {
            const categoryCodes = [];
            
            $('.category-code-item').each(function() {
                const name = $(this).find('.category-name').val();
                const code = $(this).find('.category-code').val().toUpperCase();
                
                if (name && code) {
                    categoryCodes.push({
                        name: name,
                        code: code
                    });
                }
            });
            
            // Update the data
            data.categoryCodes = categoryCodes;
            saveData();
            
            // Update the UI
            updateCategoryCodesList();
            
            // Close the modal
            $('#editCategoryCodesModal').modal('hide');
        }
        
        // Apply theme colors
        function applyTheme() {
            data.settings.theme.primaryColor = $('#primaryColorPicker').val();
            data.settings.theme.secondaryColor = $('#secondaryColorPicker').val();
            data.settings.theme.accentColor = $('#accentColorPicker').val();
            
            saveData();
            updateTheme();
        }
        
        // Reset theme to default
        function resetTheme() {
            data.settings.theme = {
                primaryColor: '#3498db',
                secondaryColor: '#2ecc71',
                accentColor: '#9b59b6'
            };
            
            saveData();
            updateSettingsUI();
            updateTheme();
        }

        // Save printer
        function savePrinter() {
            const printerName = $('#printerName').val();
            const printerModel = $('#printerModel').val();
            const printerStatus = $('#printerStatus').val();
            
            if (!printerName || !printerModel) {
                alert('נא למלא את כל השדות');
                return;
            }
            
            const newPrinter = {
                id: data.printers.length > 0 ? Math.max(...data.printers.map(p => p.id)) + 1 : 1,
                name: printerName,
                model: printerModel,
                status: printerStatus,
                lastUsed: new Date().toISOString().split('T')[0]
            };
            
            data.printers.push(newPrinter);
            saveData();
            updateUI();
            
            $('#addPrinterModal').modal('hide');
            $('#addPrinterForm')[0].reset();
        }

        // Edit printer
        function editPrinter() {
            const printerId = $(this).data('id');
            const printer = data.printers.find(p => p.id === printerId);
            
            if (printer) {
                $('#printerName').val(printer.name);
                $('#printerModel').val(printer.model);
                $('#printerStatus').val(printer.status);
                
                $('#savePrinterBtn').off('click').on('click', function() {
                    printer.name = $('#printerName').val();
                    printer.model = $('#printerModel').val();
                    printer.status = $('#printerStatus').val();
                    
                    saveData();
                    updateUI();
                    
                    $('#addPrinterModal').modal('hide');
                    $('#addPrinterForm')[0].reset();
                    $('#savePrinterBtn').off('click').on('click', savePrinter);
                });
                
                $('#addPrinterModal').modal('show');
            }
        }

        // Delete printer
        function deletePrinter() {
            const printerId = $(this).data('id');
            
            if (confirm('האם אתה בטוח שברצונך למחוק את המדפסת?')) {
                data.printers = data.printers.filter(p => p.id !== printerId);
                saveData();
                updateUI();
            }
        }

        // Save inventory item
        function saveInventory() {
            const itemSku = $('#itemSku').val();
            const itemName = $('#itemName').val();
            const itemCategory = $('#itemCategory').val();
            const itemQuantity = parseInt($('#itemQuantity').val(), 10);
            const itemPrice = parseFloat($('#itemPrice').val());
            const itemMinQuantity = parseInt($('#itemMinQuantity').val(), 10);
            
            if (!itemName || !itemCategory || isNaN(itemQuantity) || isNaN(itemPrice) || isNaN(itemMinQuantity)) {
                alert('נא למלא את כל השדות בצורה נכונה');
                return;
            }
            
            const
